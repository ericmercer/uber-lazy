
\begin{figure*}[t]
\begin{center}
\mprset{flushleft}
\begin{mathpar}
	\inferrule[Variable lookup]{}{
      (L\ R\ g\ \eta\ \cfgnt{x}\ k) \rightarrow (L\ R\ g\ \eta\ \eta(\cfgnt{x})\ k)
	}
\and
	\inferrule[Field Access(eval)]{}{
      (L\ R\ g\ \eta\ (e\ \$\ \cfgnt{f})\ k) \rightarrow (L\ R\ g\ \eta\ e\ (\cfgt{init}\ \cfgnt{f}\ (*\ \$\ \cfgnt{f} \rightarrow k)))
	}
\and
%	\inferrule[Field Access (NULL)]{
 %     L(r) = \emptyset
 %   }{
 %     (L\ R\ g\ \eta\ r\ (*\ \$\ \cfgnt{f} \rightarrow k)) \rightarrow 
%      (L[r \mapsto \{(\bot,\phi_T)\}]\ R\ \eta\ r\ (*\ \$\ \cfgnt{f} \rightarrow k))
%	}
%\and
	\inferrule[Lazy Initialization]{
	  \Lambda = \{ l \mid \exists \phi\ ((l,\phi) \in L(r) \wedge  R(l,f) = \emptyset\}\\
      l_x = \mathrm{min}_l(\Lambda) \\\\
      \Lambda \neq \emptyset \\
      \mathrm{type}(\cfgnt{f}) = \mathrm{C}_r\\
      \mathrm{init}_r() = r_f\\ 
      \mathrm{init}_l(\mathrm{C}_r) = l_f \\\\
      \rho = \{ (r^\prime,\ \phi^\prime,\ l^\prime) \mid \mathrm{isInit}(r^\prime) \wedge (l^\prime, \phi^\prime) \in L(r^\prime) \wedge \mathrm{type}(l^\prime) = \mathrm{C}_r \} \\\\
      \theta_\mathit{alias} = \{ ( l ,\ \phi) | (r^\prime,\ \phi^\prime,\ \l) \in \rho \wedge \phi = (\phi^\prime \wedge r^\prime \neq r_\mathit{null} \wedge r^\prime = r_f \wedge (\wedge_{(r^{\prime\prime},\ \phi^{\prime\prime},\ l^{\prime\prime}) \in \rho\ (r^{\prime\prime} \neq r^\prime)} r^{\prime\prime} \neq r_f )) \} \\\\
      \theta_\mathit{new} = \{(l_f,\ r_f \neq r_\mathit{null} \wedge (\wedge_{(r^\prime,\ \phi^\prime,\ l^\prime) \in \rho} r_f \ne r^\prime))\}\\\\
      \theta_\mathit{null} = \{ (l_\mathit{null},\ r_f = r_\mathit{null}) \}\\\\
      \theta = \theta_\mathit{alias} \cup \theta_\mathit{new} \cup \theta_\mathit{null}
    }{
      (L\ R\ g\ \eta\ r\ (\cfgt{init}\ \cfgnt{f}\ k)) \rightarrow 
      (L[r_f \mapsto \theta]\ R[ (l_x,f) \mapsto r_f ]\ g\ \eta\ r\ (\cfgt{init}\ \cfgnt{f}\ k))
	}
\and
	\inferrule[Lazy Initialization (end)]{
	\forall (l,\phi) \in L(r)\ (R(l,f) \neq \emptyset)
    }{
      (L\ R\ g\ \eta\ r\ (\cfgt{init}\ \cfgnt{f}\ k)) \rightarrow 
      (L\ R\ g\ \eta\ r\ k)
	}
\and
	\inferrule[New]{
      \mathrm{fresh}_r(\cfgnt{C}) = r \\
      \mathrm{fresh}_l(\cfgnt{C}) = l \\\\
      R^\prime = R[\forall \cfgnt{f} \in \mathrm{C}\ ((l\ \cfgnt{f}) \mapsto \mathrm{fresh}_r(\mathrm{type}(\cfgnt{f})))] \\\\
      L^\prime = L[r \mapsto \{(l\ \phi_T)\}]
    }{
      (L\ R\ g\ \eta\ (\cfgt{new}\ \cfgnt{C})\ k) \rightarrow 
      (L^\prime\ R^\prime\ g\ \eta\ r\ k)
	}
\and
	\inferrule[Field Access]{
      \forall (l,\phi) \in L(r)\ (l = l_{\mathit{null}} \rightarrow \neg \mathbb{S}(\phi \wedge g)) \\
      \mathrm{fresh}_r() = r_f
    }{
      (L\ R\ g\ \eta\ r\ (*\ \$\ \cfgnt{f} \rightarrow k)) \rightarrow 
      (L[r_f \mapsto \mathbb{VS}(L,R,r,f,g)]\ R\ g\ \eta\ r_f\ k)
	}
\and
    \inferrule[Equals (l-operand eval)]{}{
      (L\ R\ g\ \eta\ (\cfgnt{e}_0 = \cfgnt{e}) \ k) \rightarrow 
      (L\ R\ g\ \eta\ \cfgnt{e}_0\ (\cfgt{*}\; \cfgt{=}\; \cfgnt{e} \rightarrow \cfgnt{k}))
    }
\and
    \inferrule[Equals (r-operand eval)]{}{
    (L\ R\ g\ \eta\ \cfgnt{v}\ (\cfgt{*}\; \cfgt{=}\; \cfgnt{e} \rightarrow \cfgnt{k})) \rightarrow
    (L\ R\ g\ \eta\ \cfgnt{e}\ (\cfgnt{v}\; \cfgt{=}\; \cfgt{*} \rightarrow \cfgnt{k}))
    }
\and
    \inferrule[Equals (bool)]{
    \cfgnt{v}_0 \in \{\cfgt{true}, \cfgt{false}\} \\
    \cfgnt{v}_1 \in \{\cfgt{true}, \cfgt{false}\} \\ 
    \mathrm{eq?}(v_0, v_1) = \cfgnt{v}_r}{
    (L\ R\ g\ \eta\ \cfgnt{v}_0\ (\cfgnt{v}_1\; \cfgt{=}\; \cfgt{*} \rightarrow \cfgnt{k})) \rightarrow
    (L\ R\ g\ \eta\ \cfgnt{v}_r\ \cfgnt{k})
    }
\and
    \inferrule[Equals (references-true)]{
    \cfgnt{v}_0 \not\in \{\cfgt{true}, \cfgt{false}\} \\
    \cfgnt{v}_1 \not\in \{\cfgt{true}, \cfgt{false}\}\\\\
    \theta_\alpha = \{\phi_0 \wedge \phi_1\mid\exists (l\ \phi_0) \in L(v_0)(\exists (l\ \phi_1) \in L(v_1) ( \mathbb{S}(\phi_0 \wedge \phi_1)))\} \\\\
    \theta_0 = \{\phi_0 \mid \exists (l_0\ \phi_0) \in L(v_0) \wedge \forall (l_1\ \phi_1) \in L(v_1)(l_0 \neq l_1)\} \\\\
    \theta_1 = \{\phi_1 \mid \exists (l_1\ \phi_1) \in L(v_1) \wedge \forall (l_0\ \phi_0) \in L(v_0)(l_0 \neq l_1)\} \\\\
    \phi_g = (\vee_{\phi_\alpha\in\theta_\alpha}\phi_\alpha)\wedge(\wedge_{\phi_0 \in \theta_0} \neg \phi_0)  \wedge(\wedge_{\phi_1
    \in \theta_1} \neg \phi_1)\\ g^\prime = g \wedge \phi_g}{
     % L^\prime = L[\forall r (\exists (\cfgnt{l}\ \phi )\in L(r)(r \mapsto \mathbb{ST}(L,r,\phi_g)))]\\\\
      %X = \mathbb{ER}(L, \phi_g) \\ \mathbb{C}(L^\prime, R, X, \eta, k) = 1}
    (L\ R\ g\ \eta\ \cfgnt{v}_0\ (\cfgnt{v}_1\; \cfgt{=}\; \cfgt{*} \rightarrow \cfgnt{k})) \rightarrow
    (L^\prime\ R\ g^\prime\ \eta\ \cfgt{true}\ \cfgnt{k})
    }
\and
    \inferrule[Equals (references-false)]{
    \cfgnt{v}_0 \not\in \{\cfgt{true}, \cfgt{false}\} \\
    \cfgnt{v}_1 \not\in \{\cfgt{true}, \cfgt{false}\}\\\\
    \theta_\alpha = \{\phi_0 \rightarrow \neg \phi_1\mid\exists (l\ \phi_0) \in L(v_0)(\exists (l\ \phi_1) \in L(v_1) ( \mathbb{S}(\phi_0 \wedge \phi_1)))\} \\\\
    \theta_0 = \{\phi_0 \mid \exists (l_0\ \phi_0) \in L(v_0) \wedge \forall (l_1\ \phi_1) \in L(v_1)(l_0 \neq l_1)\} \\\\
    \theta_1 = \{\phi_1 \mid \exists (l_1\ \phi_1) \in L(v_1) \wedge \forall (l_0\ \phi_0) \in L(v_0)(l_0 \neq l_1)\} \\\\
    \phi_g = (\wedge_{\phi_\alpha\in\theta_\alpha}\phi_\alpha)\vee((\vee_{\phi_0 \in \theta_0} \phi_0)  \vee(\vee_{\phi_1
    \in \theta_1} \phi_1)) \\ g^\prime = g \wedge \phi_g}{
    (L\ R\ g\ \eta\ \cfgnt{v}_0\ (\cfgnt{v}_1\; \cfgt{=}\; \cfgt{*} \rightarrow \cfgnt{k})) \rightarrow
    (L^\prime\ R\ g^\prime\ \eta\ \cfgt{true}\ \cfgnt{k})
    }
    
  %  \\\\
  %    L^\prime = L[\forall r (\exists (\cfgnt{l}\ \phi )\in L(r)(r \mapsto \mathbb{ST}(L,r,\phi_g)))]\\\\
  %    X = \mathbb{ER}(L, \phi_g) \\ \mathbb{C}(L^\prime, R, X, \eta, k) = 1}{
 %   (L\ R\ g\ \eta\ \cfgnt{v}_0\ (\cfgnt{v}_1\; \cfgt{=}\; \cfgt{*} \rightarrow \cfgnt{k})) \rightarrow
 %   (L^\prime\ R\ \eta\ \cfgt{false}\ \cfgnt{k})
 %   }
\and
   \inferrule[Method Invocation (object eval)]{}{
    (L\ R\ g\ \eta\ \lp\cfgnt{e}_0\ \cfgt{@}\ \cfgnt{m}\ \cfgnt{e}_1\rp\ \cfgnt{k}) \rightarrow
    (L\ R\ g\ \eta\ \cfgnt{e}_0\ (\cfgt{*}\ \cfgt{@}\ \cfgnt{m}\ \cfgnt{e}_1\ \rightarrow \cfgnt{k}))
   }
   
\and
   \inferrule[Method Invocation (arg eval)]{}{
    (L\ R\ g\ \eta\ \cfgnt{v}_0\ (\cfgt{*}\ \cfgt{@}\ \cfgnt{m}\ \cfgnt{e}_1\ \rightarrow \cfgnt{k})) \rightarrow
    (L\ R\ g\ \eta\ \cfgnt{e}_1\ (\cfgnt{v}_0\ \cfgt{@}\ \cfgnt{m}\ \cfgt{*}\ \rightarrow \cfgnt{k}))
   }
%\and
%   \inferrule[Method Invocation (arg0 eval)]{}{
%    (L\ R\ \eta\ \cfgnt{v}_0\ (\cfgt{*}\ \cfgt{@}\ \cfgnt{m} \lp\cfgnt{e}_1\ \cfgnt{e}_2\ ...\rp \rightarrow \cfgnt{k})) \rightarrow
%    (L\ R\ \eta\ \cfgnt{e}_1\ (\cfgnt{v}_0\ \cfgt{@}\ \cfgnt{m}\ ()\ \cfgt{*}\ \lp\cfgnt{e}_2\ ...\rp \rightarrow \cfgnt{k}))
%   }
%\and
%   \inferrule[Method Invocation (argi eval)]{}{
%    (L\ R\ \eta\ \cfgnt{v}_i\ (\cfgnt{v}_0\ \cfgt{@}\ \cfgnt{m}\ (\cfgnt{v}_1\ ...)\ \cfgt{*}\ \lp\cfgnt{e}_{i+1}\ \cfgnt{e}_{i+2}\ ...\rp \rightarrow \cfgnt{k})) \rightarrow
%    (L\ R\ \eta\ \cfgnt{e}_{i+1}\ (\cfgnt{v}_0\ \cfgt{@}\ \cfgnt{m}\ (\cfgnt{v}_1\ ...\ v_i)\ \cfgt{*}\ \lp\cfgnt{e}_{i+2}\ ...\rp \rightarrow \cfgnt{k}))
%   }
%\and
%   \inferrule[Method Invocation (args)]{}{
%    (L\ R\ \eta\ \cfgnt{v}_n\ (\cfgnt{v}_0\ \cfgt{@}\ \cfgnt{m}\ (\cfgnt{v}_1\ ...)\ \cfgt{*}\ \lp\rp \rightarrow \cfgnt{k})) \rightarrow
%    (L\ R\ \eta\ (\cfgt{raw}\ \cfgnt{v}_0\ \cfgt{@}\ \cfgnt{m}\ (\cfgnt{v}_1\ ...\ v_n))\ \cfgnt{k})
%   }
%\and
%   \inferrule[Method Invocation (no args)]{}{
%    (L\ R\ \eta\ \cfgnt{e}_0\ (\cfgt{*}\ \cfgt{@}\ \cfgnt{m}\ \lp\rp \rightarrow \cfgnt{k})) \rightarrow
%    (L\ R\ \eta\ (\cfgt{raw}\ \cfgnt{v}_0\ \cfgt{@}\ \cfgnt{m}\ ()\ \cfgnt{k}))
%   }
\and
   \inferrule[Method Invocation (raw)]{
    \mathrm{lookup}(\cfgnt{m}) = \lp\cfgnt{T}\ \cfgnt{m}\ \lb\cfgnt{T}\ \cfgnt{x}\rb\ \ e_m\rp \\
    \eta_m = \eta[\cfgt{this} \mapsto \cfgnt{v}_0][\cfgnt{x} \mapsto \cfgnt{v}_1]\ }{
    (L\ R\ g\ \eta\ \cfgnt{v}_1\ (\cfgnt{v}_0\ \cfgt{@}\ \cfgnt{m}\ \cfgt{*}\ \rightarrow \cfgnt{k})) \rightarrow
    (L\ R\ g\ \eta\ (\cfgt{raw}\ \cfgnt{v}_0\ \cfgt{@}\ \cfgnt{m}\ \cfgnt{v}_1\ \cfgnt{k})
   }
\and
   \inferrule[Method Invocation]{
    \mathrm{lookup}(\cfgnt{m}) = \lp\cfgnt{T}\ \cfgnt{m}\ \lb\cfgnt{T}\ \cfgnt{x}\rb\ \ e_m\rp \\
    \eta_m = \eta[\cfgt{this} \mapsto \cfgnt{v}_0][\cfgnt{x} \mapsto \cfgnt{v}_1]\ }{
    (L\ R\ g\ \eta\ (\cfgt{raw}\ \cfgnt{v}_0\ \cfgt{@}\ \cfgnt{m}\ \cfgnt{v}_1\ \cfgnt{k}) \rightarrow
    (L^\prime\ R^\prime\ g\ \eta_m\ \cfgnt{e}_m\ (\cfgt{pop}\ \eta\ \cfgnt{k}))
   }

\end{mathpar}
\end{center}
\caption{Uber-lazy state reductions}
\label{fig:expr:red}
\end{figure*}

\begin{figure*}[t]
\begin{center}
\mprset{flushleft}
\begin{mathpar}
	\inferrule[ITE (expr-eval)]{}{
      (L\ R\ g\ \eta\ (\cfgt{if}\ \cfgnt{e}_0\ \cfgnt{e}_1\ \cfgt{else}\ \cfgnt{e}_2)\ k) \rightarrow (L\ R\ g\ \eta\ \cfgnt{e}_0\ (\cfgt{if}\ \cfgnt{*}\ \cfgnt{e}_1\ \cfgt{else}\ \cfgnt{e}_2) \rightarrow k)
	}
\and
	\inferrule[ITE (true)]{}{
       (L\ R\ g\ \eta\ \cfgt{true}\ (\cfgt{if}\ \cfgnt{*}\ \cfgnt{e}_1\ \cfgt{else}\ \cfgnt{e}_2) \rightarrow k) \rightarrow (L\ R\ g\ \eta\ \cfgnt{e}_1\  k)
	}
\and
	\inferrule[ITE (false)]{}{
       (L\ R\ g\ \eta\ \cfgt{false}\ (\cfgt{if}\ \cfgnt{*}\ \cfgnt{e}_1\ \cfgt{else}\ \cfgnt{e}_2) \rightarrow k) \rightarrow (L\ R\ g\ \eta\ \cfgnt{e}_2\  k)
	}
\and
	\inferrule[Field Write (eval)]{}{
       (L\ R\ g\ \eta\ (\cfgnt{x}\ \cfgt{\$}\ \cfgnt{f}\ \cfgt{:=}\ \cfgnt{e})\ k) \rightarrow (L\ R\ g\ \eta\ \cfgnt{e}\ (\cfgt{init}\ \cfgnt{f}\ (\cfgnt{x}\ \cfgt{\$}\ \cfgnt{f}\ \cfgt{:=}\ \cfgnt{*}\ \rightarrow\ k)))
	}
\and
	\inferrule[Field Write]{
	r_x = \eta(\cfgnt{x})\\
      	\Lambda = \{ l_i | (l_i,*) \in L(r_x) \wedge R(l_i,f)= \emptyset\}\\\\
      \Lambda = \emptyset \\
      %(\bot,*) \notin L(r_x)  \\\\
     \{(l_{null},\phi)|(l_{null},\phi) \in L(r) \wedge \mathbb{S}(\phi)\}=\emptyset \\\\
      \Psi_x =\{(\phi,l,r^\prime)\ |\ \exists(\cfgnt{l},\phi) \in L(r_x) \wedge \exists r^\prime \in R(\cfgnt{l,f}) \}\\\\
      X = \{ (r^\prime, l^\prime, \theta)| (\phi^\prime,l^\prime,r^\prime)\in \Psi_x \wedge \theta = \mathbb{ST}(L,r,\phi^\prime) \cup \mathbb{ST}(L,r^\prime,\neg\phi^\prime) \}\\\\
      Y= \{l\ |\ (r^\prime, l^\prime, \theta) \in X\}\\ R^\prime = R[\forall l \in Y ((l,f) \mapsto \mathrm{fresh}_r(\mathrm{C}_f)) ]\\\\
      L^\prime = L[\forall l^\prime\ (\exists (r^\prime,l^\prime,\theta) \in X\ (\exists r^{\prime\prime} = R (l^\prime,f) ( r^{\prime\prime} \mapsto \theta) ) )]
    }{
      (L\ R\ g\ \eta\ \cfgnt{r}\ (\cfgnt{x}\ \cfgt{\$}\ \cfgnt{f}\ \cfgt{:=}\ \cfgnt{*}\ \rightarrow\ k)) \rightarrow 
      (L^\prime R^\prime\ g\ \eta\ k)
	}	
\and
   \inferrule[Begin (no args)]{}{
    (L\ R\ g\ \eta\ (\cfgt{begin})\ \cfgnt{k}) \rightarrow
    (L\ R\ g\ \eta\ \cfgnt{k})
   }
\and
   \inferrule[Begin (arg0 eval)]{}{
    (L\ R\ g\ \eta\ (\cfgt{begin}\ \lp \cfgnt{e}_0\ \cfgnt{e}_1\ ...\rp) \rightarrow \cfgnt{k}) \rightarrow
    (L\ R\ g\ \eta\ \cfgnt{e}_0\ (\cfgt{begin}\ \cfgt{*}\ \lp\cfgnt{e}_1\ ...\rp) \rightarrow \cfgnt{k})
   }
\and
   \inferrule[Begin (argI eval)]{}{
    (L\ R\ g\ \eta\ v\ (\cfgt{begin}\ \cfgt{*}\ \lp\cfgnt{e}_i\ \cfgnt{e}_{i+1}\ ...\rp) \rightarrow \cfgnt{k}) \rightarrow
    (L\ R\ g\ \eta\ \cfgnt{e}_i\ (\cfgt{begin}\ \cfgt{*}\ \lp\cfgnt{e}_{i+1}\ ...\rp) \rightarrow \cfgnt{k})
   }
\and
   \inferrule[Begin (argN eval)]{}{
    (L\ R\ g\ \eta\ v\ (\cfgt{begin}\ \lp\cfgnt{e}_{n}\rp) \rightarrow \cfgnt{k}) \rightarrow
    (L\ R\ g\ \eta\ \cfgnt{e}_n\ (\cfgt{begin}\ \cfgt{*}\ \lp\rp) \rightarrow \cfgnt{k})
   }
\and
   \inferrule[Begin]{}{
    (L\ R\ g\ \eta\ v\ (\cfgt{begin}\ \cfgt{*}\ \lp\rp \rightarrow \cfgnt{k})) \rightarrow
    (L\ R\ g\ \eta\ v\ \cfgnt{k})
   }	
\and
   \inferrule[Variable Declaration (eval)]{}{
    (L\ R\ g\ \eta\ \lp\cfgt{var}\ \cfgnt{T}\ \cfgnt{x}\ \cfgt{:=}\ \cfgnt{e}_0\ \cfgt{in}\ \cfgnt{e}_1\rp\ \cfgnt{k})) \rightarrow
    (L\ R\ g\ \eta\ \cfgnt{e}_0\ \lp\cfgt{var}\ \cfgnt{T}\ \cfgnt{x}\ \cfgt{*}\ \cfgt{:=}\ \cfgt{in}\ \cfgnt{e}_1\rp \rightarrow \cfgnt{k})
   }	
\and
   \inferrule[Variable Declaration]{
   \mathrm{fresh}_r(\cfgnt{T}) = r \\
   \mathrm{fresh}_l(\cfgnt{T}) = l \\
   \eta^\prime = \eta[x \mapsto  r]\\\\
   R^\prime = R[\forall \cfgnt{f} \in \mathrm{C}\ ((l\ \cfgnt{f}) \mapsto \mathrm{fresh}_r(\mathrm{type}(\cfgnt{f})))] \\\\
   L^\prime = L[r \mapsto \{(l\ \phi_T)\}]
   }{
    (L\ R\ g\ \eta\ v\ \lp\cfgt{var}\ \cfgnt{T}\ \cfgnt{x}\ \cfgt{*}\ \cfgt{:=}\ \cfgt{in}\ \cfgnt{e}_1\rp \rightarrow \cfgnt{k}) \rightarrow
    (L^\prime\ R^\prime\ g\ \eta^
    \prime\ \cfgnt{e}_1\ (\cfgt{pop}\ \eta\ \cfgnt{k}))
   }	
\and
   \inferrule[Pop]{}{
    (L\ R\ g\ \eta\ (\cfgt{pop}\ \eta_0\ \cfgnt{k})) \rightarrow
    (L\ R\ g\ \eta_0\ \cfgnt{k})
   }
\end{mathpar}
\end{center}
\caption{Uber-lazy state reductions}
\label{fig:expr:red}
\end{figure*}

%% Expression syntax


