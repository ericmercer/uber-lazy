
\begin{figure*}[t]
\begin{center}
\mprset{flushleft}
\begin{mathpar}
	\inferrule[Variable lookup]{}{
      (L\ R\ \eta\ \cfgnt{x}\ k) \rightarrow (L\ R\ \eta\ \eta(\cfgnt{x})\ k)
	}
\and
	\inferrule[Field Access(eval)]{}{
      (L\ R\ \eta\ (e\ \$\ \cfgnt{f})\ k) \rightarrow (L\ R\ \eta\ e\ (*\ \$\ \cfgnt{f} \rightarrow k))
	}
\and
	\inferrule[Field Access (NULL)]{
      L(r) = \emptyset
    }{
      (L\ R\ \eta\ r\ (*\ \$\ \cfgnt{f} \rightarrow k)) \rightarrow 
      (L[r \mapsto \{(\bot,\phi_T)\}]\ R\ \eta\ r\ (*\ \$\ \cfgnt{f} \rightarrow k))
	}
\and
	\inferrule[Field Access (non-NULL)]{
      L(r) = \emptyset \\
      \mathrm{type}(r) = \mathrm{C}_r\\
      \mathrm{fresh}_l(\mathrm{C}_r) = l \\\\
      R^\prime = R[\forall \mathrm{f} \in \mathrm{C}_r\ ((l\ \cfgnt{f}) \mapsto \mathrm{fresh}_r(\mathrm{type}(\cfgnt{f})))]
    }{
      (L\ R\ \eta\ r\ (*\ \$\ \cfgnt{f} \rightarrow k)) \rightarrow 
      (L[r \mapsto \{(l,\phi_T)\}]\ R^\prime\ \eta\ r\ (*\ \$\ \cfgnt{f} \rightarrow k))
	}
\and
	\inferrule[New]{
      \mathrm{fresh}_r(\cfgnt{C}) = r \\
      \mathrm{fresh}_l(\cfgnt{C}) = l \\\\
      R^\prime = R[\forall \cfgnt{f} \in \mathrm{C}\ ((l\ \cfgnt{f}) \mapsto \mathrm{fresh}_r(\mathrm{type}(\cfgnt{f})))] \\\\
      L^\prime = L[r \mapsto \{(l\ \phi_T)\}]
    }{
      (L\ R\ \eta\ (\cfgt{new}\ \cfgnt{C})\ k) \rightarrow 
      (L^\prime\ R^\prime\ \eta\ r\ k)
	}
\and
	\inferrule[Field Access]{
      L(r) \neq \emptyset \\
      \mathrm{type}(r) = C_r \\
      \mathrm{fresh}_r(C_r) = r_f \\
    }{
      (L\ R\ \eta\ r\ (*\ \$\ \cfgnt{f} \rightarrow k)) \rightarrow 
      (L[r_f \mapsto \mathbb{VS}(L,R,r,f)]\ R\ \eta\ r_f\ k)
	}
\and
    \inferrule[Equals (l-operand eval)]{}{
      (L\ R\ \eta\ (\cfgnt{e}_0 = \cfgnt{e}) \ k) \rightarrow 
      (L\ R\ \eta\ \cfgnt{e}_0\ (\cfgt{*}\; \cfgt{=}\; \cfgnt{e} \rightarrow \cfgnt{k}))
    }
\and
    \inferrule[Equals (r-operand eval)]{}{
    (L\ R\ \eta\ \cfgnt{v}\ (\cfgt{*}\; \cfgt{=}\; \cfgnt{e} \rightarrow \cfgnt{k})) \rightarrow
    (L\ R\ \eta\ \cfgnt{e}\ (\cfgnt{v}\; \cfgt{=}\; \cfgt{*} \rightarrow \cfgnt{k}))
    }
\and
    \inferrule[Equals (bool)]{
    \cfgnt{v}_0 \in \{\cfgt{true}, \cfgt{false}\} \\
    \cfgnt{v}_1 \in \{\cfgt{true}, \cfgt{false}\} \\ 
    \mathrm{eq?}(v_0, v_1) = \cfgnt{v}_r}{
    (L\ R\ \eta\ \cfgnt{v}_0\ (\cfgnt{v}_1\; \cfgt{=}\; \cfgt{*} \rightarrow \cfgnt{k})) \rightarrow
    (L\ R\ \eta\ \cfgnt{v}_r\ \cfgnt{k})
    }
\and
    \inferrule[Equals (references-true)]{
    \cfgnt{v}_0 \not\in \{\cfgt{true}, \cfgt{false}\} \\
    \cfgnt{v}_1 \not\in \{\cfgt{true}, \cfgt{false}\}\\\\
    \theta_\alpha = \{\phi_1 \wedge \phi_2\mid\exists (l\ \phi_1) \in L(v_1)(\exists (l\ \phi_2) \in L(v_2) ( \mathbb{S}(\phi_1 \wedge \phi_2)))\} \\\\
    \theta_1 = \{\phi_1 \mid \exists (l_1\ \phi_1) \in L(v_1) \wedge \forall (l_2\ \phi_2) \in L(v_2)(l_1 \neq l_2)\} \\\\
    \theta_2 = \{\phi_2 \mid \exists (l_2\ \phi_2) \in L(v_2) \wedge \forall (l_1\ \phi_1) \in L(v_1)(l_1 \neq l_2)\} \\\\
    \phi_g = (\vee_{\phi_\alpha\in\theta_\alpha}\phi_\alpha)\wedge(\wedge_{\phi_1 \in \theta_1} \neg \phi_1)  \wedge(\wedge_{\phi_2
    \in \theta_2} \neg \phi_2) \\\\
      L^\prime = L[\forall r (\exists (\cfgnt{l}\ \phi )\in L(r)(r \mapsto \mathbb{ST}(L,r,\phi_g)))]\\\\
      X = \mathbb{ER}(L, \phi_g) \\ \mathbb{C}(L^\prime, R, X, \eta, k) = 1}{
    (L\ R\ \eta\ \cfgnt{v}_0\ (\cfgnt{v}_1\; \cfgt{=}\; \cfgt{*} \rightarrow \cfgnt{k})) \rightarrow
    (L^\prime\ R\ \eta\ \cfgt{true}\ \cfgnt{k})
    }
\and
    \inferrule[Equals (references-false)]{
    \cfgnt{v}_0 \not\in \{\cfgt{true}, \cfgt{false}\} \\
    \cfgnt{v}_1 \not\in \{\cfgt{true}, \cfgt{false}\}\\\\
    \theta_\alpha = \{\phi_1 \rightarrow \neg \phi_2\mid\exists (l\ \phi_1) \in L(v_1)(\exists (l\ \phi_2) \in L(v_2) ( \mathbb{S}(\phi_1 \wedge \phi_2)))\} \\\\
    \theta_1 = \{\phi_1 \mid \exists (l_1\ \phi_1) \in L(v_1) \wedge \forall (l_2\ \phi_2) \in L(v_2)(l_1 \neq l_2)\} \\\\
    \theta_2 = \{\phi_2 \mid \exists (l_2\ \phi_2) \in L(v_2) \wedge \forall (l_1\ \phi_1) \in L(v_1)(l_1 \neq l_2)\} \\\\
    \phi_g = (\wedge_{\phi_\alpha\in\theta_\alpha}\phi_\alpha)\wedge((\vee_{\phi_1 \in \theta_1} \phi_1)  \vee(\vee_{\phi_2
    \in \theta_2} \phi_2)) \\\\
      L^\prime = L[\forall r (\exists (\cfgnt{l}\ \phi )\in L(r)(r \mapsto \mathbb{ST}(L,r,\phi_g)))]\\\\
      X = \mathbb{ER}(L, \phi_g) \\ \mathbb{C}(L^\prime, R, X, \eta, k) = 1}{
    (L\ R\ \eta\ \cfgnt{v}_0\ (\cfgnt{v}_1\; \cfgt{=}\; \cfgt{*} \rightarrow \cfgnt{k})) \rightarrow
    (L^\prime\ R\ \eta\ \cfgt{false}\ \cfgnt{k})
    }
\and
   \inferrule[Method Invocation (object eval)]{}{
    (L\ R\ \eta\ \lp\cfgnt{e}_0\ \cfgt{@}\ \cfgnt{m}\ \lp\cfgnt{e}_1\ ...\rp\rp\ \cfgnt{k}) \rightarrow
    (L\ R\ \eta\ \cfgnt{e}_0\ (\cfgt{*}\ \cfgt{@}\ \cfgnt{m}\ \lp\cfgnt{e}_1\ ...\rp \rightarrow \cfgnt{k}))
   }
\and
   \inferrule[Method Invocation (arg0 eval)]{}{
    (L\ R\ \eta\ \cfgnt{v}_0\ (\cfgt{*}\ \cfgt{@}\ \cfgnt{m} \lp\cfgnt{e}_1\ \cfgnt{e}_2\ ...\rp \rightarrow \cfgnt{k})) \rightarrow
    (L\ R\ \eta\ \cfgnt{e}_1\ (\cfgnt{v}_0\ \cfgt{@}\ \cfgnt{m}\ ()\ \cfgt{*}\ \lp\cfgnt{e}_2\ ...\rp \rightarrow \cfgnt{k}))
   }
\and
   \inferrule[Method Invocation (argi eval)]{}{
    (L\ R\ \eta\ \cfgnt{v}_i\ (\cfgnt{v}_0\ \cfgt{@}\ \cfgnt{m}\ (\cfgnt{v}_1\ ...)\ \cfgt{*}\ \lp\cfgnt{e}_{i+1}\ \cfgnt{e}_{i+2}\ ...\rp \rightarrow \cfgnt{k})) \rightarrow
    (L\ R\ \eta\ \cfgnt{e}_{i+1}\ (\cfgnt{v}_0\ \cfgt{@}\ \cfgnt{m}\ (\cfgnt{v}_1\ ...\ v_i)\ \cfgt{*}\ \lp\cfgnt{e}_{i+2}\ ...\rp \rightarrow \cfgnt{k}))
   }
\and
   \inferrule[Method Invocation (args)]{}{
    (L\ R\ \eta\ \cfgnt{v}_n\ (\cfgnt{v}_0\ \cfgt{@}\ \cfgnt{m}\ (\cfgnt{v}_1\ ...)\ \cfgt{*}\ \lp\rp \rightarrow \cfgnt{k})) \rightarrow
    (L\ R\ \eta\ (\cfgt{raw}\ \cfgnt{v}_0\ \cfgt{@}\ \cfgnt{m}\ (\cfgnt{v}_1\ ...\ v_n))\ \cfgnt{k})
   }
\and
   \inferrule[Method Invocation (no args)]{}{
    (L\ R\ \eta\ \cfgnt{e}_0\ (\cfgt{*}\ \cfgt{@}\ \cfgnt{m}\ \lp\rp \rightarrow \cfgnt{k})) \rightarrow
    (L\ R\ \eta\ (\cfgt{raw}\ \cfgnt{v}_0\ \cfgt{@}\ \cfgnt{m}\ ()\ \cfgnt{k})
   }
\and
   \inferrule[Method Invocation (raw)]{
    \mathrm{lookup}(\cfgnt{m}) = \lp\cfgnt{T}\ \cfgnt{m}\ \lp\lb\cfgnt{T}\ \cfgnt{x}\rb\ ...\rp\ e_m\rp \\
    \eta_m = \eta[\cfgt{this} \mapsto \cfgnt{v}_0][\cfgnt{x} \mapsto \cfgnt{v}_1]\ ...}{
    (L\ R\ \eta\ (\cfgt{raw}\ \cfgnt{v}_0\ \cfgt{@}\ \cfgnt{m}\ (\cfgnt{v}_1\ ...)\ \cfgnt{k}) \rightarrow
    (L^\prime\ R^\prime\ \eta_m\ \cfgnt{e}_m\ (\cfgt{pop}\ \eta\ \cfgnt{k}))
   }

\end{mathpar}
\end{center}
\caption{Uber-lazy state reductions}
\label{fig:expr:red}
\end{figure*}

\begin{figure*}[t]
\begin{center}
\mprset{flushleft}
\begin{mathpar}
	\inferrule[ITE (expr-eval)]{}{
      (L\ R\ \eta\ (\cfgt{if}\ \cfgnt{e}_0\ \cfgnt{e}_1\ \cfgt{else}\ \cfgnt{e}_2)\ k) \rightarrow (L\ R\ \eta\ \cfgnt{e}_0\ (\cfgt{if}\ \cfgnt{*}\ \cfgnt{e}_1\ \cfgt{else}\ \cfgnt{e}_2) \rightarrow k)
	}
\and
	\inferrule[ITE (true)]{}{
       (L\ R\ \eta\ \cfgt{true}\ (\cfgt{if}\ \cfgnt{*}\ \cfgnt{e}_1\ \cfgt{else}\ \cfgnt{e}_2) \rightarrow k) \rightarrow (L\ R\ \eta\ \cfgnt{e}_1\  k)
	}
\and
	\inferrule[ITE (false)]{}{
       (L\ R\ \eta\ \cfgt{false}\ (\cfgt{if}\ \cfgnt{*}\ \cfgnt{e}_1\ \cfgt{else}\ \cfgnt{e}_2) \rightarrow k) \rightarrow (L\ R\ \eta\ \cfgnt{e}_2\  k)
	}
\and
	\inferrule[Field Write (expr-eval)]{}{
       (L\ R\ \eta\ (\cfgnt{x}\ \cfgt{\$}\ \cfgnt{f}\ \cfgt{:=}\ \cfgnt{e})\ k) \rightarrow (L\ R\ \eta\ \cfgnt{e}\ (\cfgnt{x}\ \cfgt{\$}\ \cfgnt{f}\ \cfgt{:=}\ \cfgnt{*})\ \rightarrow\ k)
	}
\and
	\inferrule[Field Write (NULL)]{
      L(r) = \emptyset}{
       (L\ R\ \eta\ \cfgnt{r}\ (\cfgnt{x}\ \cfgt{\$}\ \cfgnt{f}\ \cfgt{:=}\ \cfgnt{*})\ \rightarrow\ k) \rightarrow (L[r \mapsto \{(\bot,\phi_T)\}]\ R\ \eta\ \cfgnt{r}\ (\cfgnt{x}\ \cfgt{\$}\ \cfgnt{f}\ \cfgt{:=}\ \cfgnt{*})\ \rightarrow\ k)
	}
\and
	\inferrule[Field Write (non-NULL)]{
      L(r) = \emptyset \\
      \mathrm{type}(r) = \mathrm{C}_r\\
      \mathrm{fresh}_l(\mathrm{C}_r) = l \\\\
      R^\prime = R[\forall \mathrm{f} \in \mathrm{C}_r\ ((l\ \cfgnt{f}) \mapsto \mathrm{fresh}_r(\mathrm{type}(\cfgnt{f})))]
    }{
      (L\ R\ \eta\ \cfgnt{r}\ (\cfgnt{x}\ \cfgt{\$}\ \cfgnt{f}\ \cfgt{:=}\ \cfgnt{*})\ \rightarrow\ k) \rightarrow 
      (L[r \mapsto \{(l,\phi_T)\}]\ R^\prime\ \eta\ \cfgnt{r}\ (\cfgnt{x}\ \cfgt{\$}\ \cfgnt{f}\ \cfgt{:=}\ \cfgnt{*})\ \rightarrow\ k))
	}	
\and
	\inferrule[Field Write]{
      L(r) \neq \emptyset \\ r_x = \eta(\cfgt{x}) \\
      \Psi_x =\{(r^\prime,\phi)\ |\ \exists(\cfgnt{l},\phi) \in L(r_x) \wedge \exists r^\prime \in R(\cfgnt{l,f}) \}\\\\
      X = \{ (r^\prime, \theta)| (r^\prime,\phi^\prime)\in \Psi_x \wedge \theta = \mathbb{ST}(L,r,\phi^\prime) \cup \mathbb{ST}(L,r^\prime,\neg\phi^\prime) \}\\\\
      L^\prime(r) = \{\theta |  \exists (r, \theta)\in X \vee (\neg \exists (r, \theta)\in X \wedge \theta=L(r))\}  
    }{
      (L\ R\ \eta\ \cfgnt{r}\ (\cfgnt{x}\ \cfgt{\$}\ \cfgnt{f}\ \cfgt{:=}\ \cfgnt{*})\ \rightarrow\ k) \rightarrow 
      (L^\prime R\ \eta\ k))
	}	
\and
   \inferrule[Begin (no args)]{}{
    (L\ R\ \eta\ (\cfgt{begin})\ \cfgnt{k})) \rightarrow
    (L\ R\ \eta\ \cfgnt{k}))
   }
\and
   \inferrule[Begin (arg0 eval)]{}{
    (L\ R\ \eta\ (\cfgt{begin}\ \lp \cfgnt{e}_0\ \cfgnt{e}_1\ ...\rp) \rightarrow \cfgnt{k})) \rightarrow
    (L\ R\ \eta\ \cfgnt{e}_0\ (\cfgt{begin}\ \cfgt{*}\ \lp\cfgnt{e}_1\ ...\rp) \rightarrow \cfgnt{k}))
   }
\and
   \inferrule[Begin (argI eval)]{}{
    (L\ R\ \eta\ v\ (\cfgt{begin}\ \cfgt{*}\ \lp\cfgnt{e}_i\ \cfgnt{e}_{i+1}\ ...\rp) \rightarrow \cfgnt{k})) \rightarrow
    (L\ R\ \eta\ \cfgnt{e}_i\ (\cfgt{begin}\ \cfgt{*}\ \lp\cfgnt{e}_{i+1}\ ...\rp) \rightarrow \cfgnt{k}))
   }
\and
   \inferrule[Begin (argN eval)]{}{
    (L\ R\ \eta\ v\ (\cfgt{begin}\ \lp\cfgnt{e}_{n}\rp) \rightarrow \cfgnt{k})) \rightarrow
    (L\ R\ \eta\ \cfgnt{e}_n\ (\cfgt{begin}\ \cfgt{*}\ \lp\rp) \rightarrow \cfgnt{k}))
   }
\and
   \inferrule[Begin]{}{
    (L\ R\ \eta\ v\ (\cfgt{begin}\ \cfgt{*}\ \lp\rp) \rightarrow \cfgnt{k})) \rightarrow
    (L\ R\ \eta\ v\ \cfgnt{k}))
   }	
\and
   \inferrule[Variable Declaration (eval)]{}{
    (L\ R\ \eta\ \lp\cfgt{var}\ \cfgnt{T}\ \cfgnt{x}\ \cfgt{:=}\ \cfgnt{e}_0\ \cfgt{in}\ \cfgnt{e}_1\rp \cfgnt{k})) \rightarrow
    (L\ R\ \eta\ \cfgnt{e}_0\ \lp\cfgt{var}\ \cfgnt{T}\ \cfgnt{x}\ \cfgt{*}\ \cfgt{:=}\ \cfgt{in}\ \cfgnt{e}_1\rp \rightarrow \cfgnt{k}))
   }	
\and
   \inferrule[Variable Declaration]{
   \mathrm{fresh}_r(\cfgnt{T}) = r \\
   \mathrm{fresh}_l(\cfgnt{T}) = l \\
   \eta^\prime = \eta[x \mapsto  r]\\\\
   R^\prime = R[\forall \cfgnt{f} \in \mathrm{C}\ ((l\ \cfgnt{f}) \mapsto \mathrm{fresh}_r(\mathrm{type}(\cfgnt{f})))] \\\\
   L^\prime = L[r \mapsto \{(l\ \phi_T)\}]
   }{
    (L\ R\ \eta\ v\ \lp\cfgt{var}\ \cfgnt{T}\ \cfgnt{x}\ \cfgt{*}\ \cfgt{:=}\ \cfgt{in}\ \cfgnt{e}_1\rp \rightarrow \cfgnt{k})) \rightarrow
    (L^\prime\ R^\prime\ \eta^
    \prime\ \cfgnt{e}_1\ (\cfgt{pop}\ \eta\ \cfgnt{k}))
   }
\end{mathpar}
\end{center}
\caption{Uber-lazy state reductions}
\label{fig:expr:red}
\end{figure*}

%% Expression syntax


